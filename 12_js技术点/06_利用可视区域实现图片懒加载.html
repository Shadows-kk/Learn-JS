<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
      .img-box {
        width: 200px;
        height: 200px;
        margin: 10px 0 10px 10px;
        background: #eee;
        display: inline-block;
      }

      .img-box > img {
        width: 100%;
        height: 100%;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div
        class="img-box img-placeholder"
        data-src="http://suo.im/5p9IOS"
      ></div>
      <div
        class="img-box img-placeholder"
        data-src="http://suo.im/5p9IOS"
      ></div>
      <div
        class="img-box img-placeholder"
        data-src="http://suo.im/5p9IOS"
      ></div>
      <div
        class="img-box img-placeholder"
        data-src="http://suo.im/5p9IOS"
      ></div>
      <div
        class="img-box img-placeholder"
        data-src="http://suo.im/5p9IOS"
      ></div>
      <div
        class="img-box img-placeholder"
        data-src="http://suo.im/5p9IOS"
      ></div>
      <div
        class="img-box img-placeholder"
        data-src="http://suo.im/5p9IOS"
      ></div>
      <div
        class="img-box img-placeholder"
        data-src="http://suo.im/5p9IOS"
      ></div>
      <div
        class="img-box img-placeholder"
        data-src="http://suo.im/5p9IOS"
      ></div>
      <div
        class="img-box img-placeholder"
        data-src="http://suo.im/5p9IOS"
      ></div>
      <div
        class="img-box img-placeholder"
        data-src="http://suo.im/5p9IOS"
      ></div>
      <div
        class="img-box img-placeholder"
        data-src="http://suo.im/5p9IOS"
      ></div>
      <div
        class="img-box img-placeholder"
        data-src="http://suo.im/5p9IOS"
      ></div>
    </div>
    <script>
      document.addEventListener("scroll", lazyLoading);
      window.onload = () => lazyLoading();

      function lazyLoading() {
        const boxs = document.querySelectorAll(".img-placeholder");

        Array.from(boxs).map((box) => {
          if (!inViewport(box, true)) return;

          // 获取图片地址并清除数据记录
          const src = box.getAttribute("data-src");
          box.removeAttribute("data-src");

          // 插入图片 DOM
          box.innerHTML = `<img src='${src}'>`;

          // 去除占位 class
          box.className = box.className.replace("img-placeholder", "");
        });
      }

      // 封装函数，判断元素是否在可视区域内
      const inViewport = (el, partiallyVisible = false) => {
        // 使用 Element.getBoundingClientRect 方法返回元素的大小及其相对于视口的位置，可以得到当前元素相对 可视区域 的坐标
        const { top, left, bottom, right } = el.getBoundingClientRect();
        // 得到元素的坐标信息后，就需要获得 可视区域 的宽高来帮助我们确定是否在范围内
        const { innerHeight, innerWidth } = window;
        return partiallyVisible
          ? ((top > 0 && top < innerHeight) ||
              (bottom > 0 && bottom < innerHeight)) &&
              ((left > 0 && left < innerWidth) ||
                (right > 0 && right < innerWidth))
          : top >= 0 &&
              left >= 0 &&
              bottom <= innerHeight &&
              right <= innerWidth;
        // 当需要整个元素都出现在屏幕的时候，需要同时判断四个相对坐标
        // top >= 0 && left >= 0 && bottom <= innerHeight && right <= innerWidth
      };
    </script>
  </body>
</html>
